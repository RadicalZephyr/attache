#!/usr/bin/env bash

# Run hermit fetch with appropriate arguments
if [ -z "$NAMED_PROFILE" ]
then
    $HOME/.hermit/bin/hermit fetch $FETCH_REPO
    RET=$?
    CHECK_PROFILE=default
else
    $HOME/.hermit/bin/hermit fetch $FETCH_REPO $NAMED_PROFILE
    RET=$?
    CHECK_PROFILE=$NAMED_PROFILE
fi

if [ $RET -ne 0 ]
then
    echo "Fetch script exited with status: $RET."
    exit 1
fi

if [ \! -d $HOME/.hermit/profiles/$CHECK_PROFILE ]
then
    echo "Profile $CHECK_PROFILE does not exist after running fetch."
    exit 1
fi

if [ \! -d $HOME/.hermit/profiles/$CHECK_PROFILE/.git ]
then
    echo "Profile $CHECK_PROFILE is not a git repository."
    exit 1
fi

exit 0
